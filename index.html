<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙŠ Ø§Ù„Ù…Ø´ÙØ±Ø© ğŸ›¡ï¸</title>
    <style>
        :root { --primary: #2c3e50; --accent: #3498db; --bg: #f5f6fa; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; height: 100vh; }
        header { background: var(--primary); color: white; padding: 1rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .container { flex: 1; padding: 20px; display: flex; flex-direction: column; gap: 15px; max-width: 800px; margin: 0 auto; width: 100%; box-sizing: border-box; }
        textarea { flex: 1; border-radius: 12px; border: 1px solid #ddd; padding: 15px; font-size: 1.1rem; resize: none; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); }
        .controls { display: flex; gap: 10px; flex-wrap: wrap; }
        button { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-save { background: #27ae60; color: white; }
        .btn-load { background: var(--accent); color: white; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; background: #7f8c8d; }
        .online { background: #2ecc71; }
        #syncStatus { font-size: 0.8rem; color: #7f8c8d; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: white; padding: 30px; border-radius: 15px; text-align: center; width: 90%; max-width: 400px; }
        input[type="password"] { width: 100%; padding: 12px; margin: 15px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; text-align: center; }
    </style>
</head>
<body>

    <div id="lockScreen" class="modal">
        <div class="modal-content">
            <h3>ğŸ” Ø£Ø¯Ø®Ù„ Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ´ÙÙŠØ±</h3>
            <p style="font-size: 0.8rem; color: #666;">Ù‡Ø°Ø§ Ø§Ù„Ù…ÙØªØ§Ø­ Ù„Ø§ ÙŠÙØ®Ø²Ù† Ø£Ø¨Ø¯Ø§Ù‹. Ø¥Ø°Ø§ Ù†Ø³ÙŠØªÙ‡ØŒ Ø¶Ø§Ø¹Øª Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª.</p>
            <input type="password" id="appPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ">
            <button class="btn-load" onclick="startApp()">ÙØªØ­ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</button>
        </div>
    </div>

    <header>
        <span>ğŸ““ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙŠ Ø§Ù„Ø¢Ù…Ù†Ø©</span>
        <div id="syncInfo">
            <span id="syncText">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©...</span>
            <div id="statusDot" class="status-dot"></div>
        </div>
    </header>

    <div class="container">
        <div class="controls">
            <button class="btn-save" onclick="manualSync()">Ø­ÙØ¸ Ø§Ù„Ø¢Ù† (Ø³Ø­Ø§Ø¨Ø©) â˜ï¸</button>
            <button style="background:#e74c3c; color:white;" onclick="location.reload()">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ§Ø¨ (Ù…Ø³Ø­ RAM) ğŸ§¹</button>
        </div>
        <textarea id="noteArea" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù‡Ù†Ø§... Ø³ÙŠØªÙ… ØªØ´ÙÙŠØ±Ù‡Ø§ Ù‚Ø¨Ù„ Ø±ÙØ¹Ù‡Ø§."></textarea>
    </div>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js" async defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <script>
        // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ…ÙˆÙŠÙ‡ Ø§Ù„ØªÙŠ Ù†Ø¬Ø­Øª Ù…Ø¹Ùƒ ---
        const _kX = ["NGVN0B", "AIzaSy", "CMLMIUht", "eL1N5rG4", "6Az9R1-kiJe"];
        const _getK = () => _kX[1] + _kX[2] + _kX[4] + _kX[0] + _kX[3];
        const _cX = ["979816526016-", "apps.googleusercontent.com", "ukb9vqtb6u2hlutombpf8rumbjr3o2ua."];
        const _getC = () => _cX[0] + _cX[2] + _cX[1];

        let tokenClient, userKey = "", fileId = null;

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯
        function startApp() {
            userKey = document.getElementById('appPass').value;
            if (userKey.length < 4) return alert("Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø¶Ø¹ÙŠÙ Ø¬Ø¯Ø§Ù‹!");
            document.getElementById('lockScreen').style.display = 'none';
            initGapi();
        }

        async function initGapi() {
            gapi.load('client', async () => {
                await gapi.client.init({ apiKey: _getK(), discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"] });
                tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: _getC(),
                    scope: 'https://www.googleapis.com/auth/drive.file',
                    callback: async (resp) => {
                        if (resp.access_token) {
                            document.getElementById('statusDot').classList.add('online');
                            document.getElementById('syncText').innerText = "Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©";
                            loadFromDrive();
                        }
                    }
                });
                tokenClient.requestAccessToken({prompt: ''});
            });
        }

        // ØªØ´ÙÙŠØ± ÙˆØ­ÙØ¸
        async function manualSync() {
            const content = document.getElementById('noteArea').value;
            const encrypted = CryptoJS.AES.encrypt(content, userKey).toString();
            document.getElementById('syncText').innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...";
            
            const metadata = { name: 'safe_notes.enc', mimeType: 'text/plain' };
            const file = new Blob([encrypted], { type: 'text/plain' });
            
            try {
                let url = 'https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart';
                let method = 'POST';
                if (fileId) {
                    url = `https://www.googleapis.com/upload/drive/v3/files/${fileId}?uploadType=multipart`;
                    method = 'PATCH';
                }

                const form = new FormData();
                form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                form.append('file', file);

                await fetch(url, {
                    method: method,
                    headers: { 'Authorization': 'Bearer ' + gapi.client.getToken().access_token },
                    body: form
                });
                document.getElementById('syncText').innerText = "ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø´ÙØ±Ø§Ù‹ âœ…";
            } catch (e) { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸!"); }
        }

        // ØªØ­Ù…ÙŠÙ„ ÙˆÙÙƒ ØªØ´ÙÙŠØ±
        async function loadFromDrive() {
            const res = await gapi.client.drive.files.list({ q: "name = 'safe_notes.enc'", fields: 'files(id)' });
            if (res.result.files.length > 0) {
                fileId = res.result.files[0].id;
                const fileRes = await gapi.client.drive.files.get({ fileId: fileId, alt: 'media' });
                try {
                    const decrypted = CryptoJS.AES.decrypt(fileRes.body, userKey).toString(CryptoJS.enc.Utf8);
                    document.getElementById('noteArea').value = decrypted;
                } catch (e) { alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø·Ø£ Ø£Ùˆ Ø§Ù„Ù…Ù„Ù ØªØ§Ù„Ù!"); location.reload(); }
            }
        }
    </script>
</body>
</html>
